<<!DOCTYPE html>
<html>
<head>
  <title>PeerJS Video Call Example</title>
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
</head>
<body>
  <h1>PeerJS Video Call</h1>
  <video id="localVideo" autoplay></video>
  <video id="remoteVideo" autoplay></video>

  <script>
    // Create a Peer object
    var peer = new Peer("your-peer-id-can-be-autogenerated-as-well-however-must-be-the-same-at-connect-tong1");

    // Event listener for when the peer connection is open
    peer.on('open', function(peerId) {
      console.log('My peer ID is: ' + peerId);
      // getLocalStream();
    });

    // Get the local video stream
    // function getLocalStream() {
    //   navigator.mediaDevices.getUserMedia({ video: true, audio: false })
    //     .then(function(stream) {
    //       var localVideo = document.getElementById('localVideo');
    //       localVideo.srcObject = stream;
    //       establishCall(stream);
    //     })
    //     .catch(function(error) {
    //       console.log('Error accessing media devices: ' + error);
    //     });
    // }
    var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    peer.on('call', function(call) {
      getUserMedia({video: true, audio: false}, function(stream) {
        call.answer(stream); // Answer the call with an A/V stream.
        call.on('stream', function(remoteStream) {
           var localVideo = document.getElementById('localVideo');
           localVideo.srcObject = stream;
        });
      }, function(err) {
        console.log('Failed to get local stream' ,err);
      });
    });

    // Establish a call with another peer
    // function establishCall(localStream) {
    //   var otherPeerId = 'your-peer-id-can-be-autogenerated-as-well-however-must-be-the-same-at-connect-tong1'; // Replace with the ID of the peer you want to call
    //   var call = peer.call(otherPeerId, localStream);

    //   // Answer the call and set up the remote video stream
    //   call.on('stream', function(remoteStream) {
    //     var remoteVideo = document.getElementById('remoteVideo');
    //     remoteVideo.srcObject = remoteStream;
    //   });
    // }
    var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    getUserMedia({video: true, audio: false}, function(stream) {
      var otherPeerId = 'your-peer-id-can-be-autogenerated-as-well-however-must-be-the-same-at-connect-tong'; // Replace with the ID of the peer you want to call
      var call = peer.call(otherPeerId, stream);
      call.on('stream', function(remoteStream) {
        var remoteVideo = document.getElementById('remoteVideo');
        remoteVideo.srcObject = remoteStream;
        // Show stream in some video/canvas element.
      });
    }, function(err) {
      console.log('Failed to get local stream' ,err);
    });
  </script>
</body>
</html>
